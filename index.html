<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ© - Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…ÙƒØ§Ù†ÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #1A3C6B;
            --accent-color: #2ECC71;
            --bg-color: #F8F9FA;
            --text-dark: #2c3e50;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; }

        #map {
            flex-grow: 1;
            width: 100%;
            z-index: 1;
            cursor: crosshair; /* ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø± Ù„ÙŠÙˆØ­ÙŠ Ø¨Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ù†Ù‚Ø± */
        }

        /* ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø§Ù„Ø«Ø§Ø¨Øª Ø§Ù„Ù‚Ø¯ÙŠÙ… (.center-marker) */

        .action-container {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            padding: 0 20px;
            z-index: 1000;
            display: flex;
            justify-content: center;
        }

        .btn-check {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            max-width: 400px;
        }

        .btn-check:active { transform: scale(0.98); }

        .result-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.15);
            z-index: 2000;
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .result-modal.show { transform: translateY(0); }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .result-title { font-size: 1.1rem; color: var(--primary-color); font-weight: bold; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; }

        .info-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .info-icon { font-size: 1.5rem; margin-left: 15px; }
        .info-label { font-size: 0.9rem; color: #7f8c8d; display: block; margin-bottom: 3px;}
        .info-value { font-size: 1.1rem; color: var(--text-dark); font-weight: bold; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù„Ù„Ø­Ø§Ù„Ø© (Ù„ÙˆÙ† ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ) */
        .status-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .bg-green { background-color: #2e7d32; }
        .bg-blue { background-color: #1976d2; }
        .bg-purple { background-color: #7b1fa2; }

    </style>
</head>
<body>

    <div class="header">
        <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary-color);">Ù…</div>
        <div>
            <h1>Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</h1>
            <span style="font-size: 0.8rem; opacity: 0.9;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…ÙƒØ§Ù†ÙŠ</span>
        </div>
    </div>

    <div id="map"></div>

    <div class="action-container">
        <button class="btn-check" onclick="checkLocation()">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</button>
    </div>

    <div id="resultModal" class="result-modal">
        <div class="result-header">
            <span class="result-title">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</span>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        
        <div class="info-row">
            <div class="info-icon">ğŸ“</div>
            <div>
                <span class="info-label">Ø§Ù„Ø­ÙŠ Ø§Ù„ØªØ§Ø¨Ø¹</span>
                <span class="info-value" id="districtName">--</span>
            </div>
        </div>

        <div class="info-row">
            <div class="info-icon">ğŸ˜ï¸</div>
            <div>
                <span class="info-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span>
                <div style="display: flex; align-items: center;">
                    <span id="statusDot" class="status-dot"></span>
                    <span class="info-value" id="districtType">--</span>
                </div>
            </div>
        </div>
        
        </div>

    <script>
        // 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©)
        const geoData = {
            "features": [
                 {"attributes":{"FID":0,"Ø§Ù„Ø­ÙŠ":"Ø´Ø±Ù‚","type":"Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©"},"geometry":{"rings":[[[30.052622,31.184940],[30.052972,31.184622],[30.050795,31.182809],[30.048439,31.180760],[30.029899,31.173005],[29.995518,31.162961],[29.995039,31.180458],[29.996257,31.184936],[30.052622,31.184940]]]}},
                 {"attributes":{"FID":1,"Ø§Ù„Ø­ÙŠ":"Ø´Ø±Ù‚","type":"Ø³ÙƒÙ†ÙŠØ©"},"geometry":{"rings":[[[29.994560,31.205895],[29.994336,31.209127],[30.007596,31.211721],[30.015793,31.206988],[30.035072,31.198364],[30.021116,31.201194],[29.994560,31.205895]]]}},
            ]
        };

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const initialCoords = [31.2001, 29.9600];
        const map = L.map('map', { zoomControl: false }).setView(initialCoords, 13);
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ø±ÙŠÙƒ (Draggable Marker)
        // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø§Ù„Ø¢Ù† Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆÙ„ÙŠØ³ Ø·Ø¨Ù‚Ø© CSS ÙÙˆÙ‚Ù‡Ø§
        const markerIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const mainMarker = L.marker(initialCoords, {
            draggable: true, // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨
            icon: markerIcon
        }).addTo(map);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø¨ÙˆØ³ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        map.on('click', function(e) {
            mainMarker.setLatLng(e.latlng);
            closeModal(); // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ø°Ø§ ØºÙŠØ± Ø§Ù„Ù…ÙƒØ§Ù†
        });

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ù†Ø¯ Ø³Ø­Ø¨ Ø§Ù„Ø¯Ø¨ÙˆØ³
        mainMarker.on('dragstart', function() {
            closeModal();
        });

        // 4. Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¶Ù„Ø¹
        function isPointInPolygon(point, vs) {
            var x = point[0], y = point[1];
            var inside = false;
            for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
                var xi = vs[i][0], yi = vs[i][1];
                var xj = vs[j][0], yj = vs[j][1];
                var intersect = ((yi > y) != (yj > y)) &&
                    (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }
            return inside;
        }

        // 5. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù‚Ù‚
        async function checkLocation() {
            // Ø§Ù„Ø¢Ù† Ù†Ø£Ø®Ø° Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø¯Ø¨ÙˆØ³ (Marker) ÙˆÙ„ÙŠØ³ Ù…Ù† Ù…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            const position = mainMarker.getLatLng();
            const userPoint = [position.lng, position.lat]; 
            
            document.querySelector('.btn-check').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            document.querySelector('.btn-check').style.opacity = '0.8';

            setTimeout(() => {
                let foundRegion = null;

                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© (Demo Logic)
                if (position.lat > 31.18 && position.lat < 31.23 && position.lng > 29.93 && position.lng < 30.00) {
                     foundRegion = { "Ø§Ù„Ø­ÙŠ": "Ø´Ø±Ù‚", "type": "Ø³ÙƒÙ†ÙŠØ© Ù…Ù…ÙŠØ²Ø©" };
                } else if (position.lat > 31.16 && position.lat <= 31.18) {
                     foundRegion = { "Ø§Ù„Ø­ÙŠ": "Ø´Ø±Ù‚", "type": "Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©" };
                }

                showResult(foundRegion);
                
                document.querySelector('.btn-check').textContent = 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©';
                document.querySelector('.btn-check').style.opacity = '1';
            }, 500);
        }

        function showResult(data) {
            const modal = document.getElementById('resultModal');
            const distName = document.getElementById('districtName');
            const distType = document.getElementById('districtType');
            const statusDot = document.getElementById('statusDot');

            if (data) {
                distName.textContent = "Ø­ÙŠ " + data["Ø§Ù„Ø­ÙŠ"];
                
                let typeText = data["type"];
                if (typeText === "ØºÙŠØ± Ù…Ø¹Ù„ÙˆÙ…") typeText = "Ù‚ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠÙ";
                
                distType.textContent = typeText;
                
                // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù†Ù‚Ø·Ø© ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ù†ØµÙˆØµ Ø¥Ø¶Ø§ÙÙŠØ©)
                statusDot.className = 'status-dot'; // reset
                if(typeText.includes('Ø³ÙƒÙ†ÙŠØ©') || typeText.includes('Ù…Ù…ÙŠØ²')) {
                    statusDot.classList.add('bg-green');
                } else if (typeText.includes('Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©')) {
                    statusDot.classList.add('bg-blue');
                } else {
                    statusDot.classList.add('bg-purple');
                }

            } else {
                distName.textContent = "Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚";
                distType.textContent = "ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹";
                statusDot.className = 'status-dot';
            }

            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('resultModal').classList.remove('show');
        }
    </script>
</body>
</html>
